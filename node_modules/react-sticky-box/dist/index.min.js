import{useEffect as $,useState as N}from"react";import{jsx as A}from"react/jsx-runtime";var V=e=>{let t=e;for(;t=t.parentElement;){let s=getComputedStyle(t,null).getPropertyValue("overflow-y");if(t===document.body)return window;if(s==="auto"||s==="scroll")return t}return window},D=e=>e.firstChild?e.firstChild.offsetParent===e:!0,U=(e,t)=>{let s=e,i=0;D(t)||(i+=e.offsetTop-t.offsetTop,t=e.offsetParent,i+=-e.offsetTop);do i+=s.offsetTop,s=s.offsetParent;while(s&&s!==t);return i},j=e=>{let t=e.parentElement;for(;t&&getComputedStyle(t,null).getPropertyValue("display")==="contents";)t=t.parentElement;return t||window},M=null;typeof CSS<"u"&&CSS.supports&&(CSS.supports("position","sticky")?M="sticky":CSS.supports("position","-webkit-sticky")&&(M="-webkit-sticky"));var S=!1;try{let e=Object.defineProperty({},"passive",{get(){S={passive:!0}}}),t=()=>{};window.addEventListener("testPassive",t,e),window.removeEventListener("testPassive",t,e)}catch{}var x=e=>{let{el:t,onChange:s,unsubs:i,measure:l}=e;if(t===window){let r=()=>({top:0,left:0,height:window.innerHeight,width:window.innerWidth}),n=l(r()),c=()=>{Object.assign(n,l(r())),s()};return window.addEventListener("resize",c,S),i.push(()=>window.addEventListener("resize",c,S)),n}else{let r=l(t.getBoundingClientRect()),n=()=>{Object.assign(r,l(t.getBoundingClientRect())),s()},c=new ResizeObserver(n);return c.observe(t),i.push(()=>c.disconnect()),r}},z=e=>{let t=getComputedStyle(e,null),s=parseInt(t.getPropertyValue("padding-top"),10),i=parseInt(t.getPropertyValue("padding-bottom"),10);return{top:s,bottom:i}};var F=(e,t,s)=>{let{bottom:i,offsetBottom:l,offsetTop:r}=s,n=V(e),c=!1,k=()=>{c||requestAnimationFrame(()=>{let o=C();o!==m&&d(o),c=!1}),c=!0},u=n===window?window.scrollY:n.scrollTop,O=o=>{let{offsetTop:p,height:a}=T,{naturalTop:y}=P,{height:f}=v;return o+p+a>=y+f+g+l},C=()=>{let{height:o}=T,{height:p}=v;return p+r+l<=o?3:O(u)?1:2},R=n!==window&&D(n),T=x({el:n,onChange:k,unsubs:t,measure:({height:o,top:p})=>({height:o,offsetTop:R?p:0})}),E=j(e),H=E===window?{top:0,bottom:0}:z(E),P=x({el:E,onChange:k,unsubs:t,measure:({height:o})=>({height:o-H.top-H.bottom,naturalTop:E===window?0:U(E,n)+H.top+T.offsetTop})}),v=x({el:e,onChange:k,unsubs:t,measure:({height:o})=>({height:o})}),g=0,m=C(),d=o=>{let p=m;if(m=o,p===2&&(g=-1),o===3){e.style.position=M,i?e.style.bottom=`${l}px`:e.style.top=`${r}px`;return}let{height:a,offsetTop:y}=T,{height:f,naturalTop:L}=P,{height:h}=v;if(o===2)if(e.style.position="relative",g=p===0?Math.max(0,y+u-L+r):Math.max(0,y+u+a-(L+h+l)),i){let w=Math.max(0,f-h-g);e.style.bottom=`${w}px`}else e.style.top=`${g}px`;else e.style.position=M,o===1?i?e.style.bottom=`${l}px`:e.style.top=`${a-h-l}px`:i?e.style.bottom=`${a-h-l}px`:e.style.top=`${r}px`};d(m);let B=o=>{if(o===u)return;let p=o-u;if(u=o,m===3)return;let{offsetTop:a,height:y}=T,{naturalTop:f,height:L}=P,{height:h}=v;if(p>0)if(m===0){if(o+a+r>f){let w=Math.max(0,a+u-f+r);o+a+y<=f+h+w+l?d(2):d(1)}}else m===2&&O(o)&&d(1);else if(m===1){if(a+o+y<f+L+l){let w=Math.max(0,a+u+y-(f+h+l));a+o+r>=f+w?d(2):d(0)}}else m===2&&a+o+r<f+g&&d(0)},b=n===window?()=>B(window.scrollY):()=>B(n.scrollTop);n.addEventListener("scroll",b,S),n.addEventListener("mousewheel",b,S),t.push(()=>n.removeEventListener("scroll",b),()=>n.removeEventListener("mousewheel",b))},I=({offsetTop:e=0,offsetBottom:t=0,bottom:s=!1}={})=>{let[i,l]=N(null);return $(()=>{if(!i||!M)return;let r=[];return F(i,r,{offsetBottom:t,offsetTop:e,bottom:s}),()=>{r.forEach(n=>n())}},[i,t,e,s]),l},q=e=>{let{offsetTop:t,offsetBottom:s,bottom:i,children:l,className:r,style:n}=e,c=I({offsetTop:t,offsetBottom:s,bottom:i});return A("div",{className:r,style:n,ref:c,children:l})},J=q;export{J as default,I as useStickyBox};
