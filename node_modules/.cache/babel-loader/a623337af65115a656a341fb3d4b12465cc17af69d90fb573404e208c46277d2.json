{"ast":null,"code":"import _regeneratorRuntime from \"/home/uranbileg/class/TSHOP-VueJS-Frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/uranbileg/class/TSHOP-VueJS-Frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport axios from \"axios\";\nexport default {\n  name: \"Checkout\",\n  data: function data() {\n    return {\n      cart: {\n        items: []\n      },\n      stripe: {},\n      card: {},\n      first_name: \"\",\n      last_name: \"\",\n      email: \"\",\n      phone: \"\",\n      address: \"\",\n      zipcode: \"\",\n      place: \"\",\n      errors: []\n    };\n  },\n  mounted: function mounted() {\n    document.title = \"Checkout | Glee\";\n    this.cart = this.$store.state.cart;\n    if (this.getTotalQuantity > 0) {\n      this.stripe = Stripe(\"pk_test_51O9tIsJcK0ecXttYZWpFHyQlMlMOz6JjFKVnNttjQeTT1TxthKdHxWrJdpF1JKCTvXUesNxwghH1sUmUnwKqcUKL00IC7BMnYy\");\n      var elements = this.stripe.elements();\n      this.card = elements.create(\"card\", {\n        hidePostalCode: true\n      });\n      this.card.mount(\"#card-element\");\n    }\n  },\n  methods: {\n    getItemTotal: function getItemTotal(item) {\n      return item.quantity * item.product.price;\n    },\n    submitForm: function submitForm() {\n      var _this = this;\n      this.errors = [];\n      if (this.first_name === \"\") {\n        this.errors.push(\"The first name field is missing!\");\n      }\n      if (this.last_name === \"\") {\n        this.errors.push(\"The last name field is missing!\");\n      }\n      if (this.email === \"\") {\n        this.errors.push(\"The email field is missing!\");\n      }\n      if (this.phone === \"\") {\n        this.errors.push(\"The phone field is missing!\");\n      }\n      if (this.address === \"\") {\n        this.errors.push(\"The address field is missing!\");\n      }\n      if (this.zipcode === \"\") {\n        this.errors.push(\"The zip code field is missing!\");\n      }\n      if (this.place === \"\") {\n        this.errors.push(\"The place field is missing!\");\n      }\n      if (!this.errors.length) {\n        this.$store.commit(\"setIsLoading\", true);\n        this.stripe.createToken(this.card).then(function (result) {\n          if (result.error) {\n            _this.$store.commit(\"setIsLoading\", false);\n            _this.errors.push(\"Something went wrong with Stripe. Please try again\");\n            console.log(result.error.message);\n          } else {\n            _this.stripeTokenHandler(result.token);\n          }\n        });\n      }\n    },\n    stripeTokenHandler: function stripeTokenHandler(token) {\n      var _this2 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var items, i, item, obj, data;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              items = [];\n              for (i = 0; i < _this2.cart.items.length; i++) {\n                item = _this2.cart.items[i];\n                obj = {\n                  product: item.product.id,\n                  quantity: item.quantity,\n                  price: item.product.price * item.quantity\n                };\n                items.push(obj);\n              }\n              data = {\n                first_name: _this2.first_name,\n                last_name: _this2.last_name,\n                email: _this2.email,\n                address: _this2.address,\n                zipcode: _this2.zipcode,\n                place: _this2.place,\n                phone: _this2.phone,\n                items: items,\n                stripe_token: token.id\n              };\n              _context.next = 5;\n              return axios.post(\"/api/v1/checkout/\", data).then(function (response) {\n                _this2.$store.commit(\"clearCart\");\n                _this2.$router.push(\"/cart/success\");\n              })[\"catch\"](function (error) {\n                _this2.errors.push(\"Something went wrong. Please try again\");\n                console.log(error);\n              });\n            case 5:\n              _this2.$store.commit(\"setIsLoading\", false);\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }))();\n    }\n  },\n  computed: {\n    getTotalQuantity: function getTotalQuantity() {\n      return this.cart.items.reduce(function (acc, curVal) {\n        return acc += curVal.quantity;\n      }, 0);\n    },\n    cartTotalPrice: function cartTotalPrice() {\n      return this.cart.items.reduce(function (acc, curVal) {\n        return acc += curVal.product.price * curVal.quantity;\n      }, 0);\n    }\n  }\n};","map":{"version":3,"names":["axios","name","data","cart","items","stripe","card","first_name","last_name","email","phone","address","zipcode","place","errors","mounted","document","title","$store","state","getTotalQuantity","Stripe","elements","create","hidePostalCode","mount","methods","getItemTotal","item","quantity","product","price","submitForm","_this","push","length","commit","createToken","then","result","error","console","log","message","stripeTokenHandler","token","_this2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","i","obj","wrap","_callee$","_context","prev","next","id","stripe_token","post","response","$router","stop","computed","reduce","acc","curVal","cartTotalPrice"],"sources":["/home/uranbileg/class/TSHOP-VueJS-Frontend/src/views/Checkout.vue"],"sourcesContent":["<template>\n  <div class=\"page-checkout\">\n    <div class=\"columns is-multiline\">\n      <div class=\"column is-12\">\n        <h1 class=\"title\">Checkout</h1>\n      </div>\n\n      <div class=\"column is-12 box\">\n        <table class=\"table is-fullwidth\">\n          <thead>\n            <tr>\n              <th>Product</th>\n              <th>Price</th>\n              <th>Quantity</th>\n              <th>Total</th>\n            </tr>\n          </thead>\n\n          <tbody>\n            <tr v-for=\"item in cart.items\" v-bind:key=\"item.product.id\">\n              <td>{{ item.product.name }}</td>\n              <td>${{ item.product.price }}</td>\n              <td>{{ item.quantity }}</td>\n              <td>${{ getItemTotal(item).toFixed(2) }}</td>\n            </tr>\n          </tbody>\n\n          <tfoot>\n            <tr>\n              <td colspan=\"2\">Total</td>\n              <td>{{ getTotalQuantity }}</td>\n              <td>${{ cartTotalPrice.toFixed(2) }}</td>\n            </tr>\n          </tfoot>\n        </table>\n      </div>\n\n      <div class=\"column is-12 box\">\n        <h2 class=\"subtitle\">Shipping details</h2>\n\n        <p class=\"has-text-grey mb-4\">* All fields are required</p>\n\n        <div class=\"columns is-multiline\">\n          <div class=\"column is-6\">\n            <div class=\"field\">\n              <label>First name*</label>\n              <div class=\"control\">\n                <input type=\"text\" class=\"input\" v-model=\"first_name\" />\n              </div>\n            </div>\n\n            <div class=\"field\">\n              <label>Last name*</label>\n              <div class=\"control\">\n                <input type=\"text\" class=\"input\" v-model=\"last_name\" />\n              </div>\n            </div>\n\n            <div class=\"field\">\n              <label>E-mail*</label>\n              <div class=\"control\">\n                <input type=\"email\" class=\"input\" v-model=\"email\" />\n              </div>\n            </div>\n\n            <div class=\"field\">\n              <label>Phone*</label>\n              <div class=\"control\">\n                <input type=\"text\" class=\"input\" v-model=\"phone\" />\n              </div>\n            </div>\n          </div>\n\n          <div class=\"column is-6\">\n            <div class=\"field\">\n              <label>Address*</label>\n              <div class=\"control\">\n                <input type=\"text\" class=\"input\" v-model=\"address\" />\n              </div>\n            </div>\n\n            <div class=\"field\">\n              <label>Zip code*</label>\n              <div class=\"control\">\n                <input type=\"text\" class=\"input\" v-model=\"zipcode\" />\n              </div>\n            </div>\n\n            <div class=\"field\">\n              <label>Place*</label>\n              <div class=\"control\">\n                <input type=\"text\" class=\"input\" v-model=\"place\" />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"notification is-danger mt-4\" v-if=\"errors.length\">\n          <p v-for=\"error in errors\" v-bind:key=\"error\">{{ error }}</p>\n        </div>\n\n        <hr />\n\n        <div id=\"card-element\" class=\"mb-5\"></div>\n\n        <template v-if=\"getTotalQuantity\">\n          <hr />\n\n          <button class=\"button is-dark\" @click=\"submitForm\">\n            Pay with Stripe\n          </button>\n        </template>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\n\nexport default {\n  name: \"Checkout\",\n  data() {\n    return {\n      cart: {\n        items: [],\n      },\n      stripe: {},\n      card: {},\n      first_name: \"\",\n      last_name: \"\",\n      email: \"\",\n      phone: \"\",\n      address: \"\",\n      zipcode: \"\",\n      place: \"\",\n      errors: [],\n    };\n  },\n  mounted() {\n    document.title = \"Checkout | Glee\";\n\n    this.cart = this.$store.state.cart;\n\n    if (this.getTotalQuantity > 0) {\n      this.stripe = Stripe(\n        \"pk_test_51O9tIsJcK0ecXttYZWpFHyQlMlMOz6JjFKVnNttjQeTT1TxthKdHxWrJdpF1JKCTvXUesNxwghH1sUmUnwKqcUKL00IC7BMnYy\"\n      );\n      const elements = this.stripe.elements();\n      this.card = elements.create(\"card\", { hidePostalCode: true });\n\n      this.card.mount(\"#card-element\");\n    }\n  },\n  methods: {\n    getItemTotal(item) {\n      return item.quantity * item.product.price;\n    },\n    submitForm() {\n      this.errors = [];\n\n      if (this.first_name === \"\") {\n        this.errors.push(\"The first name field is missing!\");\n      }\n\n      if (this.last_name === \"\") {\n        this.errors.push(\"The last name field is missing!\");\n      }\n\n      if (this.email === \"\") {\n        this.errors.push(\"The email field is missing!\");\n      }\n\n      if (this.phone === \"\") {\n        this.errors.push(\"The phone field is missing!\");\n      }\n\n      if (this.address === \"\") {\n        this.errors.push(\"The address field is missing!\");\n      }\n\n      if (this.zipcode === \"\") {\n        this.errors.push(\"The zip code field is missing!\");\n      }\n\n      if (this.place === \"\") {\n        this.errors.push(\"The place field is missing!\");\n      }\n\n      if (!this.errors.length) {\n        this.$store.commit(\"setIsLoading\", true);\n\n        this.stripe.createToken(this.card).then((result) => {\n          if (result.error) {\n            this.$store.commit(\"setIsLoading\", false);\n\n            this.errors.push(\n              \"Something went wrong with Stripe. Please try again\"\n            );\n\n            console.log(result.error.message);\n          } else {\n            this.stripeTokenHandler(result.token);\n          }\n        });\n      }\n    },\n    async stripeTokenHandler(token) {\n      const items = [];\n\n      for (let i = 0; i < this.cart.items.length; i++) {\n        const item = this.cart.items[i];\n        const obj = {\n          product: item.product.id,\n          quantity: item.quantity,\n          price: item.product.price * item.quantity,\n        };\n\n        items.push(obj);\n      }\n\n      const data = {\n        first_name: this.first_name,\n        last_name: this.last_name,\n        email: this.email,\n        address: this.address,\n        zipcode: this.zipcode,\n        place: this.place,\n        phone: this.phone,\n        items: items,\n        stripe_token: token.id,\n      };\n\n      await axios\n        .post(\"/api/v1/checkout/\", data)\n        .then((response) => {\n          this.$store.commit(\"clearCart\");\n          this.$router.push(\"/cart/success\");\n        })\n        .catch((error) => {\n          this.errors.push(\"Something went wrong. Please try again\");\n\n          console.log(error);\n        });\n\n      this.$store.commit(\"setIsLoading\", false);\n    },\n  },\n  computed: {\n    getTotalQuantity() {\n      return this.cart.items.reduce((acc, curVal) => {\n        return (acc += curVal.quantity);\n      }, 0);\n    },\n    cartTotalPrice() {\n      return this.cart.items.reduce((acc, curVal) => {\n        return (acc += curVal.product.price * curVal.quantity);\n      }, 0);\n    },\n  },\n};\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}